<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air_Hockey Assistant</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <link rel="stylesheet" href="styles/hockey-visualization.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div id="app">
        <header class="header">
            <div class="container">
                <h1 class="logo">
                    <span class="logo-icon">üèí</span>
                    Air Hockey Assistant
                </h1>
                <nav class="nav">
                    <button class="nav-btn" data-tab="game">Game Control</button>
                    <button class="nav-btn" data-tab="history">Game History</button>
                    <button class="nav-btn" data-tab="analysis">Game Analysis</button>
                    <button class="nav-btn" data-tab="report">Match Report</button>
                </nav>
            </div>
        </header>

        <main class="main">
            <!-- Game Control Panel -->
            <section id="game-tab" class="tab-content active">
                <div class="container">
                    <!-- Player Setup Section -->
                    <div class="player-setup">
                        <h2>üèí Game Setup</h2>
                        <div class="players-config">
                            <div class="player-config">
                                <h3>Player A</h3>
                                <div class="player-input-group">
                                    <select id="playerASelect" class="player-select">
                                        <option value="">-- Select Player A --</option>
                                    </select>
                                    <input type="text" id="playerACustom" class="player-input" placeholder="Enter custom player name" maxlength="30" style="display: none;">
                                    <button id="savePlayerA" class="btn btn-small btn-secondary" style="display: none;">üíæ Save to Database</button>
                                </div>
                            </div>
                            <div class="vs-divider">
                                <span>VS</span>
                            </div>
                            <div class="player-config">
                                <h3>Player B</h3>
                                <div class="player-input-group">
                                    <select id="playerBSelect" class="player-select">
                                        <option value="">-- Select Player B --</option>
                                    </select>
                                    <input type="text" id="playerBCustom" class="player-input" placeholder="Enter custom player name" maxlength="30" style="display: none;">
                                    <button id="savePlayerB" class="btn btn-small btn-secondary" style="display: none;">üíæ Save to Database</button>
                                </div>
                            </div>
                        </div>
                        <div class="setup-actions">
                            <button id="confirmPlayers" class="btn btn-primary">‚úÖ Confirm Players</button>
                            <button id="refreshPlayers" class="btn btn-secondary">üîÑ Refresh Players</button>
                            <span id="playersStatus" class="players-status">Please select or enter player names</span>
                        </div>
                    </div>
                    
                    <div class="game-control">
                        <h2>Game Control Panel</h2>
                        <div class="control-panel">
                            <button id="startGame" class="btn btn-primary" disabled>Start Game</button>
                            <button id="pauseGame" class="btn btn-secondary" disabled>Pause Game</button>
                            <button id="endGame" class="btn btn-danger" disabled>End Game</button>
                        </div>
                        
                        <div class="websocket-controls">
                            <h4>WebSocket Test Controls</h4>
                            <div class="test-buttons">
                                <button id="simulateGoalA" class="btn btn-export">Player A Goal</button>
                                <button id="simulateGoalB" class="btn btn-export">Player B Goal</button>
                                <button id="checkConnection" class="btn btn-secondary">Check Connection</button>
                            </div>
                        </div>
                        
                        <div class="game-status">
                            <div class="status-indicator">
                                <span class="status-label">Game Status:</span>
                                <span id="gameStatus" class="status-value">Not Started</span>
                            </div>
                            <div class="timer">
                                <span class="timer-label">Game Time:</span>
                                <span id="gameTimer" class="timer-value">00:00</span>
                            </div>
                            <div class="connection-status">
                                <span class="connection-label">Server:</span>
                                <span id="wsStatus" class="ws-status disconnected">Disconnected</span>
                            </div>
                        </div>
                    </div>

                    <div class="scoreboard">
                        <h3>Live Score</h3>
                        <div class="score-display">
                            <div class="player-score">
                                <div class="player-name">Player A</div>
                                <div class="score" id="scoreA">0</div>
                            </div>
                            <div class="vs">VS</div>
                            <div class="player-score">
                                <div class="player-name">Player B</div>
                                <div class="score" id="scoreB">0</div>
                            </div>
                        </div>
                    </div>



                    <!-- Real-time Game Visualization -->
                    <div class="game-visualization">
                        <h3>üèí Real-time Game View</h3>
                        <div class="hockey-table-container">
                            <!-- Hockey Table Surface -->
                            <div id="hockeyTable" class="hockey-table">
                                <div class="table-surface">
                                    <!-- Border Lines -->
                                    <div class="table-border"></div>
                                    
                                    <!-- Center Line -->
                                    <div class="center-line"></div>
                                    
                                    <!-- Goal A (Left Side) -->
                                    <div class="goal goal-a">
                                        <div class="goal-line"></div>
                                        <div class="goal-area"></div>
                                    </div>
                                    
                                    <!-- Goal B (Right Side) -->
                                    <div class="goal goal-b">
                                        <div class="goal-line"></div>
                                        <div class="goal-area"></div>
                                    </div>
                                    
                                                                <!-- Pusher A -->
                            <div id="pusherA" class="pusher pusher-a">
                                <div class="pusher-handle"></div>
                            </div>
                            
                            <!-- Pusher B -->
                            <div id="pusherB" class="pusher pusher-b">
                                <div class="pusher-handle"></div>
                            </div>
                                    
                                    <!-- Puck -->
                                    <div id="puck" class="puck">
                                        <div class="puck-trail"></div>
                                    </div>
                                    
                                    <!-- Position Indicator - Hidden to avoid obstruction -->
                                    <!-- 
                                    <div class="position-indicator" id="positionIndicator" style="display: none;">
                                        <div class="indicator-dot"></div>
                                        <div class="indicator-coords"></div>
                                    </div>
                                    -->
                                </div>
                            </div>
                            
                            <!-- Control Panel Below Table -->
                            <div class="visualization-controls">
                                <div class="control-group">
                                    <label>
                                        <input type="checkbox" id="showTrails" checked> Show Trails
                                    </label>
                                    <label>
                                        <input type="checkbox" id="showCoordinates"> Show Coordinates
                                    </label>
                                    <label>
                                        <input type="checkbox" id="pauseVisualization"> Pause Updates
                                    </label>
                                </div>
                                <div class="status-group">
                                    <div class="status-item">
                                        <span class="status-label">MQTT Connection:</span>
                                        <span id="mqttStatus" class="status-value disconnected">Disconnected</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">Update Rate:</span>
                                        <span id="updateRate" class="status-value">0 Hz</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Position Information Display Below Controls -->
                            <div class="position-info">
                                <div class="info-section">
                                    <h4>Pusher A</h4>
                                    <div class="position-data">
                                        <span>X: <span id="pusherAX">--</span></span>
                                        <span>Y: <span id="pusherAY">--</span></span>
                                    </div>
                                </div>
                                <div class="info-section">
                                    <h4>Puck</h4>
                                    <div class="position-data">
                                        <span>X: <span id="puckX">--</span></span>
                                        <span>Y: <span id="puckY">--</span></span>
                                        <span>Speed: <span id="puckSpeed">--</span></span>
                                    </div>
                                </div>
                                <div class="info-section">
                                    <h4>Pusher B</h4>
                                    <div class="position-data">
                                        <span>X: <span id="pusherBX">--</span></span>
                                        <span>Y: <span id="pusherBY">--</span></span>
                                    </div>
                                </div>
                                <div class="info-section" id="mouseCoordinatesSection" style="display: none;">
                                    <h4>Mouse Position</h4>
                                    <div class="position-data">
                                        <span>X: <span id="mouseX">--</span></span>
                                        <span>Y: <span id="mouseY">--</span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="live-feed">
                        <h3>Live Match Feed</h3>
                        <div id="liveFeed" class="feed-container">
                            <div class="feed-item info">
                                <div class="feed-item-icon">‚ÑπÔ∏è</div>
                                <div class="feed-item-content">
                                    <div class="feed-item-time">--:--:--</div>
                                    <div class="feed-item-message">Waiting for game to start...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Game History -->
            <section id="history-tab" class="tab-content">
                <div class="container">
                    <h2>üéÆ Game History</h2>
                    <div class="history-controls">
                        <div class="history-toolbar">
                            <div class="info-display">
                                <span id="totalGames" class="info-item">Total Games: 0</span>
                                <span id="completedGames" class="info-item">Completed: 0</span>
                                <span id="activeGames" class="info-item">Active: 0</span>
                            </div>
                            <div class="action-controls">
                                <button id="refreshHistory" class="btn btn-secondary">üîÑ Refresh</button>
                                <button id="clearHistory" class="btn btn-danger">üóëÔ∏è Clear All</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="games-container">
                        <div id="gamesGrid" class="games-grid">
                            <div class="no-games">No games found. Start a new game to see history.</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Game Analysis -->
            <section id="analysis-tab" class="tab-content">
                <div class="container">
                    <h2>Game Analysis Dashboard</h2>
                    <div class="analysis-controls">
                        <div class="analysis-toolbar">
                            <!-- Simplified to 3 core analysis modes -->
                            <div class="analysis-modes">
                                <button class="mode-btn active" data-mode="rounds">
                                    <span class="mode-icon">üìä</span>
                                    <span class="mode-text">Round Analysis</span>
                                    <span class="mode-desc">Round-by-round timeline view</span>
                                </button>
                                <button class="mode-btn" data-mode="detailed">
                                    <span class="mode-icon">üéØ</span>
                                    <span class="mode-text">Detailed Analysis</span>
                                    <span class="mode-desc">In-depth technical analysis</span>
                                </button>
                                <button class="mode-btn" data-mode="comparison">
                                    <span class="mode-icon">‚öñÔ∏è</span>
                                    <span class="mode-text">Player Comparison</span>
                                    <span class="mode-desc">A vs B performance comparison</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analysis-container">
                        <div id="pointBreakdown" class="point-breakdown">
                            <div class="no-data">No match data available</div>
                        </div>
                    </div>
                </div>
            </section>



            <!-- Match Report -->
            <section id="report-tab" class="tab-content">
                <div class="container">
                    <h2>Match Summary Report</h2>
                    <div class="report-container">
                        <div class="report-header">
                            <h3>Match Overview</h3>
                            <div class="export-controls">
                                <button id="exportPDF" class="btn btn-export">Export PDF</button>
                                <button id="exportExcel" class="btn btn-export">Export Excel</button>
                            </div>
                        </div>

                        <div class="report-content">
                            <div class="report-section">
                                <h4>Final Score</h4>
                                <div id="finalScore" class="final-score">
                                    <div class="score-item">
                                        <span class="player">Player A:</span>
                                        <span class="score">0</span>
                                    </div>
                                    <div class="score-item">
                                        <span class="player">Player B:</span>
                                        <span class="score">0</span>
                                    </div>
                                </div>
                            </div>

                            <div class="report-section">
                                <h4>Error Statistics</h4>
                                <div class="chart-container">
                                    <canvas id="errorChart"></canvas>
                                </div>
                            </div>

                            <div class="report-section">
                                <h4>AI Improvement Suggestions</h4>
                                <div id="aiSuggestions" class="ai-suggestions">
                                    <div class="suggestion-item">Complete a match to see AI analysis suggestions</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 Air_Hockey Assistant. Smart Air Hockey Training System.</p>
                <p id="playerManagerVersion" class="version-info">PlayerManager: Loading...</p>
            </div>
        </footer>
    </div>

    <script src="js/config.js"></script>
    <script src="js/websocket.js"></script>
    <script src="js/playerManagement.js"></script>
    <script src="js/hockeyVisualization.js"></script>
    <script src="js/app.js"></script>
    <script src="js/gameControl.js"></script>
    <script src="js/gameHistory.js"></script>
    <script src="js/analysis.js"></script>

    <script src="js/report.js"></script>
    <script src="js/export.js"></script>
</body>
</html> 